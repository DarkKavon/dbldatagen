<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using the Data Generator with Delta Live Tables &mdash; Databricks Labs Data Generator 0.3.4 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/tdg.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="Extending Text Generation" href="extending_text_generation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Databricks Labs Data Generator
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="APIDOCS.html">Get Started Here</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation_notes.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating_column_data.html">Generating column data</a></li>
<li class="toctree-l1"><a class="reference internal" href="DATARANGES.html">Using data ranges</a></li>
<li class="toctree-l1"><a class="reference internal" href="textdata.html">Generating text data</a></li>
<li class="toctree-l1"><a class="reference internal" href="DISTRIBUTIONS.html">Using data distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="options_and_features.html">Options for column specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="repeatable_data_generation.html">Repeatable Data Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="repeatable_data_generation.html#revisiting-the-iot-data-example">Revisiting the IOT data example</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_streaming_data.html">Using streaming data</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating_json_data.html">Generating JSON and structured column data</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating_from_existing_data.html">Generating synthetic data from existing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating_cdc_data.html">Generating Change Data Capture (CDC) data</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_table_data.html">Using multiple tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending_text_generation.html">Extending text generation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Use with Delta Live Tables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installing-the-data-generator-in-a-delta-live-tables-notebook">Installing the data generator in a Delta Live Tables notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-a-dlt-live-table-with-synthetic-data-source">Defining a DLT live table with synthetic data source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-synthetic-data-sources-in-delta-live-tables">Using the synthetic data sources in Delta Live Tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting data generation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="relnotes/quickindex.html">Quick API index</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/api/modules.html">The dbldatagen package API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CONTRIBUTING.html">Contributing to the Databricks Labs Data Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CONTRIBUTING.html#building-the-code">Building the code</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CONTRIBUTING.html#testing">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CONTRIBUTING.html#using-the-databricks-labs-data-generator">Using the Databricks Labs data generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CONTRIBUTING.html#coding-style">Coding Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/CHANGELOG.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="relnotes/requirements.html">Build requirements</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">License</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Databricks Labs Data Generator</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Using the Data Generator with Delta Live Tables</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/using_delta_live_tables.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="using-the-data-generator-with-delta-live-tables">
<h1>Using the Data Generator with Delta Live Tables<a class="headerlink" href="#using-the-data-generator-with-delta-live-tables" title="Permalink to this heading"></a></h1>
<p>Delta Live Tables is one of the newer Databricks platform features for creating reliable batch and streaming ingest
pipelines using Python and SQL. It allows for creating ingest pipelines using Python code (and SQL) with annotations
to define the tables and views produced.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<blockquote>
<div><p>You can find more information on Delta Live Tables at the following links:</p>
</div></blockquote>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.databricks.com/delta-live-tables/index.html">Delta Live Tables</a></p></li>
<li><p><a class="reference external" href="https://learn.microsoft.com/en-us/azure/databricks/delta-live-tables/">Delta Live Tables on Azure</a></p></li>
<li><p><a class="reference external" href="https://www.databricks.com/blog/2022/04/25/simplifying-change-data-capture-with-databricks-delta-live-tables.html">Change Data Capture with Databricks Delta Live Tables</a></p></li>
</ul>
</div>
<p>You can use the Databricks Labs Data Generator inside of a Delta Live Tables to generate synthetic data sources for
both batch and streaming sources. You can also use it from outside a Delta Live Tables pipeline to write data to a
file that is subsequently read via <cite>Autoloader</cite> or a <cite>spark.read</cite> operation within a Delta Live Tables pipeline.</p>
<section id="installing-the-data-generator-in-a-delta-live-tables-notebook">
<h2>Installing the data generator in a Delta Live Tables notebook<a class="headerlink" href="#installing-the-data-generator-in-a-delta-live-tables-notebook" title="Permalink to this heading"></a></h2>
<p>You can install the Databricks Labs Data Generator in a DLT notebook using the same command that you would use in a
regular Python notebook</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">dbldatagen</span>
</pre></div>
</div>
<p>This must be the first cell in the notebook ahead of any initial markup cells.</p>
<p>You can subsequently define a source based on the use of the data generator to generate a table, view or
live / streaming table.</p>
</section>
<section id="defining-a-dlt-live-table-with-synthetic-data-source">
<h2>Defining a DLT live table with synthetic data source<a class="headerlink" href="#defining-a-dlt-live-table-with-synthetic-data-source" title="Permalink to this heading"></a></h2>
<p>Once the library has been installed in the Delta Live Tables pipeline, you can use the DLT annotations
combined with the data generator code to create a DLT live or live streaming sources.</p>
<p>For example, the following code will generate a batch of device events indicating their state (<cite>running</cite>, <cite>idle</cite> etc)
along with timestamp of change of state for a series of devices.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dlt</span>
<span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>

<span class="nd">@dlt</span><span class="o">.</span><span class="n">table</span>
<span class="k">def</span> <span class="nf">device_data_source</span><span class="p">():</span>
  <span class="n">DEVICE_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RUNNING&#39;</span><span class="p">,</span> <span class="s1">&#39;IDLE&#39;</span><span class="p">,</span> <span class="s1">&#39;DOWN&#39;</span><span class="p">]</span>
  <span class="n">DEVICE_WEIGHTS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span><span class="mi">1</span> <span class="p">]</span>
  <span class="n">SITES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">]</span>
  <span class="n">AREAS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;area 1&#39;</span><span class="p">,</span> <span class="s1">&#39;area 2&#39;</span><span class="p">,</span> <span class="s1">&#39;area 3&#39;</span><span class="p">,</span> <span class="s1">&#39;area 4&#39;</span><span class="p">,</span> <span class="s1">&#39;area 5&#39;</span><span class="p">]</span>
  <span class="n">LINES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;line 1&#39;</span><span class="p">,</span> <span class="s1">&#39;line 2&#39;</span><span class="p">,</span> <span class="s1">&#39;line 3&#39;</span><span class="p">,</span> <span class="s1">&#39;line 4&#39;</span><span class="p">,</span> <span class="s1">&#39;line 5&#39;</span><span class="p">,</span> <span class="s1">&#39;line 6&#39;</span><span class="p">]</span>
  <span class="n">TAGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;statusCode&#39;</span><span class="p">,</span> <span class="s1">&#39;another notification 1&#39;</span><span class="p">,</span> <span class="s1">&#39;another notification 2&#39;</span><span class="p">,</span>
          <span class="s1">&#39;another notification 3&#39;</span><span class="p">]</span>
  <span class="n">NUM_LOCAL_DEVICES</span> <span class="o">=</span> <span class="mi">20</span>

  <span class="n">STARTING_DATETIME</span><span class="o">=</span><span class="s2">&quot;2022-06-01 01:00:00&quot;</span>
  <span class="n">END_DATETIME</span><span class="o">=</span><span class="s2">&quot;2022-09-01 23:59:00&quot;</span>
  <span class="n">EVENT_INTERVAL</span> <span class="o">=</span> <span class="s2">&quot;10 seconds&quot;</span>

  <span class="n">testDataSpec</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dg</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;site&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">SITES</span><span class="p">,</span>  <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">AREAS</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">LINES</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;local_device_id&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="n">NUM_LOCAL_DEVICES</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;local_device&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">,</span>  <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;local_device_id&quot;</span><span class="p">)</span>

   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;deviceKey&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
               <span class="n">expr</span> <span class="o">=</span> <span class="s2">&quot;concat(&#39;/&#39;, site, &#39;/&#39;, area, &#39;/&#39;, line, &#39;/&#39;, local_device)&quot;</span><span class="p">,</span>
               <span class="n">baseColumn</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;local_device&quot;</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="s2">&quot;site&quot;</span><span class="p">])</span>

   <span class="c1"># tag name is name of device signal</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tagName&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">TAGS</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

   <span class="c1"># tag value is state</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tagValue&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
               <span class="n">values</span><span class="o">=</span><span class="n">DEVICE_STATES</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">DEVICE_WEIGHTS</span><span class="p">,</span>
               <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tag_ts&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
               <span class="n">begin</span><span class="o">=</span><span class="n">STARTING_DATETIME</span><span class="p">,</span>
               <span class="n">end</span><span class="o">=</span><span class="n">END_DATETIME</span><span class="p">,</span>
               <span class="n">interval</span><span class="o">=</span><span class="n">EVENT_INTERVAL</span><span class="p">,</span>
               <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

   <span class="p">)</span>

  <span class="n">dfTestData</span> <span class="o">=</span> <span class="n">testDataSpec</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

  <span class="k">return</span> <span class="n">dfTestData</span>
</pre></div>
</div>
<p>To change this to a streaming live table, you only need change the parameters to the call to the <cite>build</cite> method.</p>
<p>For example, replacing the build line with following code will change it to a DLT live streaming table.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfTestData</span> <span class="o">=</span> <span class="n">testDataSpec</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">withStreaming</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rowsPerSecond&#39;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">}))</span>
</pre></div>
</div>
<p>You may define many streaming and non-streaming sources in the same Delta Live Tables pipeline notebooks
allowing experimentation, benchmarking and exploration of different design approaches for your pipelines.</p>
</section>
<section id="using-the-synthetic-data-sources-in-delta-live-tables">
<h2>Using the synthetic data sources in Delta Live Tables<a class="headerlink" href="#using-the-synthetic-data-sources-in-delta-live-tables" title="Permalink to this heading"></a></h2>
<p>Once one or more synthetic data sources have been defined in a DLT pipeline, they can be used as sources for other
downstreaming computations, views, as sources of joins etc.</p>
<p>The following example illustrates the use of a synthetic data source to experiment with the creation of summary tables.</p>
<p>For this example, we will enhance the source by materializing the <code class="docutils literal notranslate"><span class="pre">site</span></code> key and and an <cite>event_date</cite> so that
they can be used for partitioning, and compute a derived summary table indicating the latest state for each device.</p>
<p>First of all, here is the revised source</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dlt</span>
<span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>

<span class="nd">@dlt</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;device_data_source&quot;</span><span class="p">,</span> <span class="n">partition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;site&quot;</span><span class="p">,</span> <span class="s2">&quot;event_date&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">device_data_raw</span><span class="p">():</span>
  <span class="n">DEVICE_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RUNNING&#39;</span><span class="p">,</span> <span class="s1">&#39;IDLE&#39;</span><span class="p">,</span> <span class="s1">&#39;DOWN&#39;</span><span class="p">]</span>
  <span class="n">DEVICE_WEIGHTS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span><span class="mi">1</span> <span class="p">]</span>
  <span class="n">SITES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">]</span>
  <span class="n">AREAS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;area 1&#39;</span><span class="p">,</span> <span class="s1">&#39;area 2&#39;</span><span class="p">,</span> <span class="s1">&#39;area 3&#39;</span><span class="p">,</span> <span class="s1">&#39;area 4&#39;</span><span class="p">,</span> <span class="s1">&#39;area 5&#39;</span><span class="p">]</span>
  <span class="n">LINES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;line 1&#39;</span><span class="p">,</span> <span class="s1">&#39;line 2&#39;</span><span class="p">,</span> <span class="s1">&#39;line 3&#39;</span><span class="p">,</span> <span class="s1">&#39;line 4&#39;</span><span class="p">,</span> <span class="s1">&#39;line 5&#39;</span><span class="p">,</span> <span class="s1">&#39;line 6&#39;</span><span class="p">]</span>
  <span class="n">TAGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;statusCode&#39;</span><span class="p">,</span> <span class="s1">&#39;another notification 1&#39;</span><span class="p">,</span> <span class="s1">&#39;another notification 2&#39;</span><span class="p">,</span>
          <span class="s1">&#39;another notification 3&#39;</span><span class="p">]</span>
  <span class="n">NUM_LOCAL_DEVICES</span> <span class="o">=</span> <span class="mi">20</span>

  <span class="n">STARTING_DATETIME</span><span class="o">=</span><span class="s2">&quot;2022-06-01 01:00:00&quot;</span>
  <span class="n">END_DATETIME</span><span class="o">=</span><span class="s2">&quot;2022-09-01 23:59:00&quot;</span>
  <span class="n">EVENT_INTERVAL</span> <span class="o">=</span> <span class="s2">&quot;10 seconds&quot;</span>

  <span class="n">rowsRequested</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1000000</span>

  <span class="n">testDataSpec</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dg</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rowsRequested</span><span class="p">)</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;site&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">SITES</span><span class="p">,</span>  <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">AREAS</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">LINES</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;local_device_id&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="n">NUM_LOCAL_DEVICES</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;local_device&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">,</span>
               <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;local_device_id&quot;</span><span class="p">)</span>

   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;deviceKey&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
               <span class="n">expr</span> <span class="o">=</span> <span class="s2">&quot;concat(&#39;/&#39;, site, &#39;/&#39;, area, &#39;/&#39;, line, &#39;/&#39;, local_device)&quot;</span><span class="p">,</span>
               <span class="n">baseColumn</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;local_device&quot;</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="s2">&quot;site&quot;</span><span class="p">])</span>

   <span class="c1"># tag name is name of device signal</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tagName&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">TAGS</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

   <span class="c1"># tag value is state</span>
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tagValue&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
               <span class="n">values</span><span class="o">=</span><span class="n">DEVICE_STATES</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">DEVICE_WEIGHTS</span><span class="p">,</span>
               <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tag_ts&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
               <span class="n">begin</span><span class="o">=</span><span class="n">STARTING_DATETIME</span><span class="p">,</span>
               <span class="n">end</span><span class="o">=</span><span class="n">END_DATETIME</span><span class="p">,</span>
               <span class="n">interval</span><span class="o">=</span><span class="n">EVENT_INTERVAL</span><span class="p">,</span>
               <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;event_date&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;to_date(tag_ts)&quot;</span><span class="p">,</span> <span class="n">baseColumn</span><span class="o">=</span><span class="s2">&quot;tag_ts&quot;</span><span class="p">)</span>
   <span class="p">)</span>

  <span class="n">dfTestData</span> <span class="o">=</span> <span class="n">testDataSpec</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

  <span class="k">return</span> <span class="n">dfTestData</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;tagName = &#39;statusCode&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now lets create a summary table that stores the latest state for each device.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dlt</span>
<span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>

<span class="nd">@dlt</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;device_data_summary&quot;</span><span class="p">,</span>
           <span class="n">table_properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;delta.checkpoint.writeStatsAsStruct&quot;</span> <span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;delta.checkpoint.writeStatsAsJson&quot;</span> <span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;delta.autoOptimize.optimizeWrite&quot;</span> <span class="p">:</span> <span class="s2">&quot;true&quot;</span>
                            <span class="p">}</span>
          <span class="p">)</span>
<span class="k">def</span> <span class="nf">device_summary</span><span class="p">():</span>
  <span class="k">return</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    with ranked as (select deviceKey, tagValue, tag_ts,</span>
<span class="s2">           row_number() over (partition by deviceKey order by tag_ts desc) as rn</span>
<span class="s2">           from LIVE.device_data_source)</span>
<span class="s2">    select deviceKey, tagValue as state, tag_ts,rn from ranked</span>
<span class="s2">           where rn == 1</span>
<span class="s2">  &quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see in the example above, once the synthetic data source is created, it can be referred in the same way
as any other DLT live or streaming table.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="extending_text_generation.html" class="btn btn-neutral float-left" title="Extending Text Generation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Databricks Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>